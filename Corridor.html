<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corridor Weekly Planner</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .lucide-icon {
            width: 20px;
            height: 20px;
            stroke-width: 2;
            stroke: currentColor;
            fill: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Icon = ({ children, ...props }) => (
            <svg className="lucide-icon" {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                {children}
            </svg>
        );

        const Plus = () => <Icon><path d="M5 12h14M12 5v14"/></Icon>;
        const X = () => <Icon><path d="M18 6 6 18M6 6l12 12"/></Icon>;
        const ChevronLeft = () => <Icon><path d="m15 18-6-6 6-6"/></Icon>;
        const ChevronRight = () => <Icon><path d="m9 18 6-6-6-6"/></Icon>;
        const Settings = () => <Icon><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const LogOut = () => <Icon><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/></Icon>;
        const Users = () => <Icon><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const Palette = () => <Icon><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></Icon>;
        const Tag = () => <Icon><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></Icon>;
        const Bell = () => <Icon><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></Icon>;
        const Clock = () => <Icon><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>;
        const Calendar = () => <Icon><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>;

        const CorridorWeeklyPlanner = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [showLogin, setShowLogin] = useState(true);
            const [showSettings, setShowSettings] = useState(false);
            const [showUserManagement, setShowUserManagement] = useState(false);
            const [showAbout, setShowAbout] = useState(false);
            const [events, setEvents] = useState([]);
            const [editingEvent, setEditingEvent] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [currentWeekStart, setCurrentWeekStart] = useState(null);
            const [theme, setTheme] = useState('blue');
            const [customActivities, setCustomActivities] = useState([]);
            const [newActivityName, setNewActivityName] = useState('');
            const [newActivityColor, setNewActivityColor] = useState('blue');
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });
            const [registerForm, setRegisterForm] = useState({ username: '', email: '', password: '', confirmPassword: '' });
            const [showRegister, setShowRegister] = useState(false);
            const [newEvent, setNewEvent] = useState({
                title: '',
                date: '',
                startTime: '09:00',
                endTime: '10:00',
                type: 'study',
                notes: '',
                reminders: []
            });

            const hours = Array.from({ length: 15 }, (_, i) => i + 7);

            const themes = {
                blue: { primary: 'bg-blue-600 hover:bg-blue-700', accent: 'bg-blue-50', text: 'text-blue-900' },
                green: { primary: 'bg-green-600 hover:bg-green-700', accent: 'bg-green-50', text: 'text-green-900' },
                purple: { primary: 'bg-purple-600 hover:bg-purple-700', accent: 'bg-purple-50', text: 'text-purple-900' },
                orange: { primary: 'bg-orange-600 hover:bg-orange-700', accent: 'bg-orange-50', text: 'text-orange-900' },
                pink: { primary: 'bg-pink-600 hover:bg-pink-700', accent: 'bg-pink-50', text: 'text-pink-900' }
            };

            const activityColors = {
                blue: 'bg-blue-100 border-blue-400 text-blue-900',
                green: 'bg-green-100 border-green-400 text-green-900',
                purple: 'bg-purple-100 border-purple-400 text-purple-900',
                yellow: 'bg-yellow-100 border-yellow-400 text-yellow-900',
                red: 'bg-red-100 border-red-400 text-red-900',
                indigo: 'bg-indigo-100 border-indigo-400 text-indigo-900',
                pink: 'bg-pink-100 border-pink-400 text-pink-900',
                orange: 'bg-orange-100 border-orange-400 text-orange-900',
                gray: 'bg-gray-100 border-gray-400 text-gray-900'
            };

            const defaultActivities = [
                { id: 'study', name: 'Study', color: 'blue', isDefault: true },
                { id: 'teaching', name: 'Teaching', color: 'green', isDefault: true },
                { id: 'class', name: 'Class', color: 'purple', isDefault: true },
                { id: 'break', name: 'Break', color: 'yellow', isDefault: true }
            ];

            useEffect(() => {
                loadUserSession();
            }, []);

            useEffect(() => {
                if (currentUser) {
                    const initialDate = new Date('2025-11-09');
                    setCurrentWeekStart(initialDate);
                    loadUserData();
                }
            }, [currentUser]);

            useEffect(() => {
                if (currentWeekStart) {
                    setNewEvent(prev => ({
                        ...prev,
                        date: formatDate(currentWeekStart)
                    }));
                }
            }, [currentWeekStart]);

            const validateEmail = (email) => {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            };

            const loadUserSession = async () => {
                try {
                    const result = await window.storage.get('current-session');
                    if (result?.value) {
                        const session = JSON.parse(result.value);
                        setCurrentUser(session);
                        setShowLogin(false);
                    }
                } catch (error) {
                    console.log('No active session');
                }
            };

            const loadUserData = async () => {
                if (!currentUser) return;
                
                try {
                    const eventsResult = await window.storage.get(`user-events-${currentUser.username}`);
                    if (eventsResult?.value) {
                        setEvents(JSON.parse(eventsResult.value));
                    }

                    const themeResult = await window.storage.get(`user-theme-${currentUser.username}`);
                    if (themeResult?.value) {
                        setTheme(themeResult.value);
                    }

                    const activitiesResult = await window.storage.get(`user-activities-${currentUser.username}`);
                    if (activitiesResult?.value) {
                        setCustomActivities(JSON.parse(activitiesResult.value));
                    }
                } catch (error) {
                    console.log('Loading user data');
                }
            };

            const saveUserData = async (data, type) => {
                if (!currentUser) return;
                
                try {
                    await window.storage.set(`user-${type}-${currentUser.username}`, JSON.stringify(data));
                } catch (error) {
                    console.error('Failed to save:', error);
                }
            };

            const handleLogin = async () => {
                if (!loginForm.username || !loginForm.password) {
                    alert('Please fill in all fields');
                    return;
                }

                try {
                    const usersResult = await window.storage.get('users-db', true);
                    const users = usersResult?.value ? JSON.parse(usersResult.value) : [];
                    
                    const user = users.find(u => u.username === loginForm.username && u.password === loginForm.password);
                    
                    if (user) {
                        setCurrentUser(user);
                        await window.storage.set('current-session', JSON.stringify(user));
                        setShowLogin(false);
                        setLoginForm({ username: '', password: '' });
                    } else {
                        alert('Invalid username or password');
                    }
                } catch (error) {
                    alert('Login failed: ' + error.message);
                }
            };

            const handleRegister = async () => {
                if (!registerForm.username || !registerForm.password || !registerForm.confirmPassword) {
                    alert('Please fill in all fields');
                    return;
                }

                if (registerForm.password !== registerForm.confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }

                if (registerForm.password.length < 6) {
                    alert('Password must be at least 6 characters long');
                    return;
                }

                try {
                    const usersResult = await window.storage.get('users-db', true);
                    const users = usersResult?.value ? JSON.parse(usersResult.value) : [];
                    
                    if (users.find(u => u.username === registerForm.username)) {
                        alert('Username already exists');
                        return;
                    }

                    // For non-admin users, require and validate email
                    if (users.length > 0) {
                        if (!registerForm.email) {
                            alert('Email is required for registration');
                            return;
                        }
                        if (!validateEmail(registerForm.email)) {
                            alert('Please enter a valid email address');
                            return;
                        }
                        if (users.find(u => u.email === registerForm.email)) {
                            alert('Email already registered');
                            return;
                        }
                    }

                    const newUser = {
                        username: registerForm.username,
                        email: registerForm.email || '',
                        password: registerForm.password,
                        role: users.length === 0 ? 'admin' : 'user',
                        createdAt: new Date().toISOString()
                    };

                    users.push(newUser);
                    await window.storage.set('users-db', JSON.stringify(users), true);
                    
                    alert('Registration successful! Please login.');
                    setShowRegister(false);
                    setRegisterForm({ username: '', email: '', password: '', confirmPassword: '' });
                } catch (error) {
                    alert('Registration failed: ' + error.message);
                }
            };

            const handleLogout = async () => {
                try {
                    await window.storage.delete('current-session');
                    setCurrentUser(null);
                    setShowLogin(true);
                    setEvents([]);
                    setCustomActivities([]);
                    setTheme('blue');
                } catch (error) {
                    console.error('Logout failed');
                }
            };

            const loadAllUsers = async () => {
                try {
                    const result = await window.storage.get('users-db', true);
                    return result?.value ? JSON.parse(result.value) : [];
                } catch (error) {
                    return [];
                }
            };

            const deleteUser = async (username) => {
                if (!currentUser || currentUser.role !== 'admin') return;
                
                try {
                    const users = await loadAllUsers();
                    const updatedUsers = users.filter(u => u.username !== username);
                    await window.storage.set('users-db', JSON.stringify(updatedUsers), true);
                    
                    await window.storage.delete(`user-events-${username}`);
                    await window.storage.delete(`user-theme-${username}`);
                    await window.storage.delete(`user-activities-${username}`);
                    
                    alert('User deleted successfully');
                } catch (error) {
                    alert('Failed to delete user');
                }
            };

            const addCustomActivity = () => {
                if (!newActivityName.trim()) return;
                
                const newActivity = {
                    id: `custom-${Date.now()}`,
                    name: newActivityName,
                    color: newActivityColor,
                    isDefault: false
                };
                
                const updated = [...customActivities, newActivity];
                setCustomActivities(updated);
                saveUserData(updated, 'activities');
                setNewActivityName('');
                setNewActivityColor('blue');
            };

            const deleteCustomActivity = (id) => {
                const updated = customActivities.filter(a => a.id !== id);
                setCustomActivities(updated);
                saveUserData(updated, 'activities');
            };

            const changeTheme = (newTheme) => {
                setTheme(newTheme);
                window.storage.set(`user-theme-${currentUser.username}`, newTheme);
            };

            const allActivities = [...defaultActivities, ...customActivities];

            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            const getWeekDates = (startDate) => {
                const dates = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(startDate);
                    date.setDate(date.getDate() + i);
                    dates.push(date);
                }
                return dates;
            };

            const getDayName = (date) => {
                return date.toLocaleDateString('en-US', { weekday: 'long' });
            };

            const getShortDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            };

            const navigateWeek = (direction) => {
                const newDate = new Date(currentWeekStart);
                newDate.setDate(newDate.getDate() + (direction * 7));
                setCurrentWeekStart(newDate);
            };

            const goToToday = () => {
                const today = new Date();
                const dayOfWeek = today.getDay();
                const sunday = new Date(today);
                sunday.setDate(today.getDate() - dayOfWeek);
                setCurrentWeekStart(sunday);
            };

            const scheduleReminders = (event) => {
                if (!('Notification' in window)) {
                    console.log('This browser does not support notifications');
                    return;
                }

                if (Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                if (Notification.permission === 'granted') {
                    event.reminders.forEach(reminder => {
                        const eventDateTime = new Date(`${event.date}T${event.startTime}`);
                        const reminderTime = new Date(eventDateTime.getTime() - reminder * 60000);
                        const timeUntilReminder = reminderTime.getTime() - Date.now();

                        if (timeUntilReminder > 0) {
                            setTimeout(() => {
                                new Notification(`Upcoming: ${event.title}`, {
                                    body: `Starting in ${reminder} minutes at ${event.startTime}`,
                                    icon: 'ðŸ“…',
                                    tag: `event-${event.id}-${reminder}`,
                                    requireInteraction: true
                                });
                            }, timeUntilReminder);
                        }
                    });
                }
            };

            const addReminder = (minutes) => {
                if (!newEvent.reminders.includes(minutes)) {
                    setNewEvent({
                        ...newEvent,
                        reminders: [...newEvent.reminders, minutes].sort((a, b) => b - a)
                    });
                }
            };

            const removeReminder = (minutes) => {
                setNewEvent({
                    ...newEvent,
                    reminders: newEvent.reminders.filter(r => r !== minutes)
                });
            };

            const requestNotificationPermission = () => {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            alert('Notifications enabled! You will receive reminders for your events.');
                        }
                    });
                }
            };

            const addEvent = () => {
                if (!newEvent.title.trim() || !newEvent.date) return;
                
                const event = { ...newEvent, id: Date.now() };
                const updatedEvents = [...events, event];
                setEvents(updatedEvents);
                saveUserData(updatedEvents, 'events');
                
                if (event.reminders && event.reminders.length > 0) {
                    scheduleReminders(event);
                }
                
                setNewEvent({
                    title: '',
                    date: formatDate(currentWeekStart),
                    startTime: '09:00',
                    endTime: '10:00',
                    type: 'study',
                    notes: '',
                    reminders: []
                });
                setShowAddForm(false);
            };

            const deleteEvent = (id) => {
                const updatedEvents = events.filter(e => e.id !== id);
                setEvents(updatedEvents);
                saveUserData(updatedEvents, 'events');
            };

            const startEdit = (event) => {
                setEditingEvent({ ...event });
            };

            const saveEdit = () => {
                const updatedEvents = events.map(e => 
                    e.id === editingEvent.id ? editingEvent : e
                );
                setEvents(updatedEvents);
                saveUserData(updatedEvents, 'events');
                setEditingEvent(null);
            };

            const getEventPosition = (event) => {
                const [startHour, startMin] = event.startTime.split(':').map(Number);
                const [endHour, endMin] = event.endTime.split(':').map(Number);
                const top = ((startHour - 7) * 60 + startMin);
                const height = ((endHour - startHour) * 60 + (endMin - startMin));
                return { top, height };
            };

            const getEventColor = (type) => {
                const activity = allActivities.find(a => a.id === type);
                return activity ? activityColors[activity.color] : activityColors.gray;
            };

            if (showLogin) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-6">
                                <div className="flex items-center justify-center gap-2 mb-3">
                                    <Calendar className="text-indigo-600" style={{width: '32px', height: '32px'}} />
                                    <h1 className="text-3xl font-bold text-gray-800">CORRIDOR</h1>
                                </div>
                                <h2 className="text-xl font-semibold text-indigo-600">Weekly Planner</h2>
                                <p className="text-gray-600 mt-2 text-sm">Your Ultimate Schedule Management Tool</p>
                            </div>

                            {showAbout && (
                                <div className="mb-6 p-4 bg-indigo-50 rounded-lg text-sm">
                                    <h3 className="font-semibold text-indigo-900 mb-2">About Corridor Weekly Planner</h3>
                                    <p className="text-gray-700 mb-2">
                                        Corridor is a comprehensive weekly planning system designed for students, teachers, and professionals who need to balance multiple responsibilities.
                                    </p>
                                    <ul className="list-disc list-inside text-gray-700 space-y-1 mb-2">
                                        <li>Multi-week scheduling from any date</li>
                                        <li>Customizable activity types and themes</li>
                                        <li>Smart reminders and notifications</li>
                                        <li>Secure user accounts with email verification</li>
                                        <li>Admin management for organizations</li>
                                    </ul>
                                    <button 
                                        onClick={() => setShowAbout(false)}
                                        className="text-indigo-600 hover:text-indigo-800 font-medium"
                                    >
                                        Close
                                    </button>
                                </div>
                            )}

                            {!showAbout && (
                                <button 
                                    onClick={() => setShowAbout(true)}
                                    className="w-full mb-4 text-indigo-600 hover:text-indigo-800 text-sm font-medium"
                                >
                                    Learn more about Corridor â†’
                                </button>
                            )}
                            
                            {!showRegister ? (
                                <div>
                                    <h2 className="text-xl font-semibold mb-4">Login to Your Account</h2>
                                    <input
                                        type="text"
                                        placeholder="Username"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <input
                                        type="password"
                                        placeholder="Password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <button
                                        onClick={handleLogin}
                                        className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 mb-3 transition font-semibold"
                                    >
                                        Login
                                    </button>
                                    <button
                                        onClick={() => setShowRegister(true)}
                                        className="w-full bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition font-semibold"
                                    >
                                        Create New Account
                                    </button>
                                </div>
                            ) : (
                                <div>
                                    <h2 className="text-xl font-semibold mb-4">Create New Account</h2>
                                    <input
                                        type="text"
                                        placeholder="Username"
                                        value={registerForm.username}
                                        onChange={(e) => setRegisterForm({...registerForm, username: e.target.value})}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <input
                                        type="email"
                                        placeholder="Email Address"
                                        value={registerForm.email}
                                        onChange={(e) => setRegisterForm({...registerForm, email: e.target.value})}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <input
                                        type="password"
                                        placeholder="Password (min 6 characters)"
                                        value={registerForm.password}
                                        onChange={(e) => setRegisterForm({...registerForm, password: e.target.value})}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <input
                                        type="password"
                                        placeholder="Confirm Password"
                                        value={registerForm.confirmPassword}
                                        onChange={(e) => setRegisterForm({...registerForm, confirmPassword: e.target.value})}
                                        onKeyPress={(e) => e.key === 'Enter' && handleRegister()}
                                        className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <div className="text-xs text-gray-600 mb-4 p-3 bg-indigo-50 rounded-lg">
                                        <strong>Note:</strong> The first user to register becomes the admin. All other users must provide a valid email address.
                                    </div>
                                    <button
                                        onClick={handleRegister}
                                        className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 mb-3 transition font-semibold"
                                    >
                                        Register
                                    </button>
                                    <button
                                        onClick={() => setShowRegister(false)}
                                        className="w-full bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition font-semibold"
                                    >
                                        Back to Login
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (!currentWeekStart) return <div className="p-8 text-center">Loading...</div>;

            const weekDates = getWeekDates(currentWeekStart);
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-4">
                            <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
                                <div>
                                    <div className="flex items-center gap-2">
                                        <Calendar className="text-indigo-600" style={{width: '28px', height: '28px'}} />
                                        <h1 className="text-3xl font-bold text-gray-800">CORRIDOR Weekly Planner</h1>
                                    </div>
                                    <p className="text-gray-600 mt-1">
                                        Welcome, <span className="font-semibold">{currentUser?.username}</span>
                                        {currentUser?.role === 'admin' && <span className="ml-2 px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">Admin</span>}
                                    </p>
                                </div>
                                <div className="flex gap-2 flex-wrap">
                                    <button
                                        onClick={() => setShowSettings(!showSettings)}
                                        className={`${themes[theme].primary} text-white px-4 py-2 rounded-lg flex items-center gap-2 transition`}
                                    >
                                        <Settings />
                                        Settings
                                    </button>
                                    {currentUser?.role === 'admin' && (
                                        <button
                                            onClick={() => setShowUserManagement(!showUserManagement)}
                                            className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center gap-2 transition"
                                        >
                                            <Users />
                                            Users
                                        </button>
                                    )}
                                    <button
                                        onClick={handleLogout}
                                        className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center gap-2 transition"
                                    >
                                        <LogOut />
                                    </button>
                                </div>
                            </div>

                            {showSettings && (
                                <div className="bg-gray-50 p-4 rounded-lg mb-4 border border-gray-200">
                                    <div className="mb-6">
                                        <h3 className="font-semibold mb-3 flex items-center gap-2 text-lg">
                                            <Bell />
                                            Notifications
                                        </h3>
                                        <div className="p-3 bg-white rounded-lg">
                                            {!('Notification' in window) ? (
                                                <p className="text-sm text-gray-600">Notifications are not supported in this browser.</p>
                                            ) : Notification.permission === 'granted' ? (
                                                <div className="flex items-center gap-2 text-green-600">
                                                    <Bell />
                                                    <span className="font-medium">Notifications Enabled</span>
                                                </div>
                                            ) : Notification.permission === 'denied' ? (
                                                <p className="text-sm text-red-600">Notifications are blocked. Please enable them in your browser settings.</p>
                                            ) : (
                                                <button
                                                    onClick={requestNotificationPermission}
                                                    className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                                >
                                                    Enable Notifications
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    <h3 className="font-semibold mb-4 flex items-center gap-2 text-lg">
                                        <Palette />
                                        Theme Selection
                                    </h3>
                                    <div className="flex gap-3 mb-6">
                                        {Object.keys(themes).map(themeName => (
                                            <button
                                                key={themeName}
                                                onClick={() => changeTheme(themeName)}
                                                className={`w-12 h-12 rounded-lg ${themes[themeName].primary} ${theme === themeName ? 'ring-4 ring-gray-400 scale-110' : ''} transition transform hover:scale-105`}
                                                title={themeName.charAt(0).toUpperCase() + themeName.slice(1)}
                                            />
                                        ))}
                                    </div>

                                    <h3 className="font-semibold mb-3 flex items-center gap-2 text-lg">
                                        <Tag />
                                        Custom Activities
                                    </h3>
                                    
                                    <div className="mb-4 max-h-48 overflow-y-auto">
                                        {customActivities.length === 0 ? (
                                            <div className="text-gray-500 text-sm italic p-3 bg-white rounded">
                                                No custom activities yet. Add one below!
                                            </div>
                                        ) : (
                                            customActivities.map(activity => (
                                                <div key={activity.id} className="flex items-center justify-between mb-2 p-3 bg-white rounded shadow-sm">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-6 h-6 ${activityColors[activity.color]} border-2 rounded`}></div>
                                                        <span className="font-medium">{activity.name}</span>
                                                    </div>
                                                    <button
                                                        onClick={() => deleteCustomActivity(activity.id)}
                                                        className="text-red-600 hover:text-red-800 hover:bg-red-50 p-1 rounded transition"
                                                    >
                                                        <X />
                                                    </button>
                                                </div>
                                            ))
                                        )}
                                    </div>

                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            placeholder="Activity name (e.g., Meeting, Homework)"
                                            value={newActivityName}
                                            onChange={(e) => setNewActivityName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && addCustomActivity()}
                                            className="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <select
                                            value={newActivityColor}
                                            onChange={(e) => setNewActivityColor(e.target.value)}
                                            className="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        >
                                            {Object.keys(activityColors).map(color => (
                                                <option key={color} value={color}>
                                                    {color.charAt(0).toUpperCase() + color.slice(1)}
                                                </option>
                                            ))}
                                        </select>
                                        <button
                                            onClick={addCustomActivity}
                                            disabled={!newActivityName.trim()}
                                            className={`${themes[theme].primary} text-white px-4 py-2 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed transition`}
                                        >
                                            Add
                                        </button>
                                    </div>
                                </div>
                            )}

                            {showUserManagement && currentUser?.role === 'admin' && (
                                <UserManagement deleteUser={deleteUser} loadAllUsers={loadAllUsers} currentUser={currentUser} />
                            )}

                            <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
                                <div className="flex items-center gap-3">
                                    <button 
                                        onClick={() => navigateWeek(-1)} 
                                        className="p-2 hover:bg-gray-100 rounded-lg transition"
                                        title="Previous week"
                                    >
                                        <ChevronLeft />
                                    </button>
                                    <div className="text-lg font-semibold">
                                        {currentWeekStart.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} - {weekEnd.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
                                    </div>
                                    <button 
                                        onClick={() => navigateWeek(1)} 
                                        className="p-2 hover:bg-gray-100 rounded-lg transition"
                                        title="Next week"
                                    >
                                        <ChevronRight />
                                    </button>
                                    <button 
                                        onClick={goToToday} 
                                        className="ml-2 px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm transition"
                                    >
                                        Today
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowAddForm(!showAddForm)}
                                    className={`${themes[theme].primary} text-white px-4 py-2 rounded-lg flex items-center gap-2 transition`}
                                >
                                    <Plus />
                                    Add Event
                                </button>
                            </div>

                            <div className="flex flex-wrap gap-3 mb-4">
                                {allActivities.map(activity => (
                                    <div key={activity.id} className="flex items-center gap-2">
                                        <div className={`w-4 h-4 ${activityColors[activity.color]} border-2 rounded`}></div>
                                        <span className="text-sm">{activity.name}</span>
                                    </div>
                                ))}
                            </div>

                            {showAddForm && (
                                <div className="bg-gray-50 p-4 rounded-lg mb-4 border border-gray-200">
                                    <h3 className="font-semibold mb-3">Add New Event</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <input
                                            type="text"
                                            placeholder="Event title"
                                            value={newEvent.title}
                                            onChange={(e) => setNewEvent({...newEvent, title: e.target.value})}
                                            className="col-span-2 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <input
                                            type="date"
                                            value={newEvent.date}
                                            onChange={(e) => setNewEvent({...newEvent, date: e.target.value})}
                                            min="2025-11-09"
                                            className="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <select
                                            value={newEvent.type}
                                            onChange={(e) => setNewEvent({...newEvent, type: e.target.value})}
                                            className="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        >
                                            {allActivities.map(activity => (
                                                <option key={activity.id} value={activity.id}>{activity.name}</option>
                                            ))}
                                        </select>
                                        <input
                                            type="time"
                                            value={newEvent.startTime}
                                            onChange={(e) => setNewEvent({...newEvent, startTime: e.target.value})}
                                            className="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <input
                                            type="time"
                                            value={newEvent.endTime}
                                            onChange={(e) => setNewEvent({...newEvent, endTime: e.target.value})}
                                            className="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <input
                                            type="text"
                                            placeholder="Notes (optional)"
                                            value={newEvent.notes}
                                            onChange={(e) => setNewEvent({...newEvent, notes: e.target.value})}
                                            className="col-span-2 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                        
                                        <div className="col-span-2">
                                            <label className="block text-sm font-medium mb-2 flex items-center gap-2">
                                                <Bell />
                                                Reminders
                                            </label>
                                            <div className="flex flex-wrap gap-2 mb-2">
                                                {newEvent.reminders.map(minutes => (
                                                    <div key={minutes} className="flex items-center gap-1 bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-sm">
                                                        <Clock />
                                                        {minutes} min before
                                                        <button
                                                            onClick={() => removeReminder(minutes)}
                                                            className="ml-1 text-indigo-600 hover:text-indigo-800"
                                                        >
                                                            <X />
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="flex gap-2 flex-wrap">
                                                <button
                                                    type="button"
                                                    onClick={() => addReminder(5)}
                                                    className="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm"
                                                >
                                                    5 min
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => addReminder(15)}
                                                    className="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm"
                                                >
                                                    15 min
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => addReminder(30)}
                                                    className="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm"
                                                >
                                                    30 min
                                                </button>
                                                <button
                                                    type="button"
                                                    onClick={() => addReminder(60)}
                                                    className="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded text-sm"
                                                >
                                                    1 hour
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex gap-2 mt-3">
                                        <button
                                            onClick={addEvent}
                                            disabled={!newEvent.title.trim() || !newEvent.date}
                                            className={`${themes[theme].primary} text-white px-4 py-2 rounded-lg disabled:bg-gray-400 transition`}
                                        >
                                            Add Event
                                        </button>
                                        <button
                                            onClick={() => setShowAddForm(false)}
                                            className="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-lg shadow-lg overflow-auto">
                            <div className="grid grid-cols-8 min-w-[1200px]">
                                <div className="col-span-1 border-r">
                                    <div className="h-20 border-b bg-gray-50"></div>
                                    {hours.map(hour => (
                                        <div key={hour} className="h-16 border-b px-2 py-1 text-sm text-gray-600 bg-gray-50">
                                            {hour}:00
                                        </div>
                                    ))}
                                </div>

                                {weekDates.map((date, dayIndex) => {
                                    const dateStr = formatDate(date);
                                    const isToday = formatDate(new Date()) === dateStr;
                                    
                                    return (
                                        <div key={dayIndex} className="col-span-1 border-r relative">
                                            <div className={`h-20 border-b ${isToday ? themes[theme].accent : 'bg-gray-50'} px-2 py-2 text-center`}>
                                                <div className="font-semibold">{getDayName(date)}</div>
                                                <div className="text-sm text-gray-600">{getShortDate(date)}</div>
                                            </div>
                                            <div className="relative" style={{ height: `${hours.length * 64}px` }}>
                                                {hours.map((hour, idx) => (
                                                    <div key={hour} className="absolute w-full border-b" style={{ top: `${idx * 64}px`, height: '64px' }}></div>
                                                ))}
                                                {events.filter(e => e.date === dateStr).map(event => {
                                                    const { top, height } = getEventPosition(event);
                                                    const isEditing = editingEvent?.id === event.id;
                                                    
                                                    return (
                                                        <div
                                                            key={event.id}
                                                            className={`absolute left-1 right-1 ${getEventColor(event.type)} border-l-4 rounded px-2 py-1 text-xs overflow-hidden cursor-pointer hover:shadow-md transition-shadow`}
                                                            style={{ top: `${top}px`, height: `${height}px` }}
                                                            onClick={() => !isEditing && startEdit(event)}
                                                        >
                                                            {isEditing ? (
                                                                <div className="space-y-1">
                                                                    <input
                                                                        type="text"
                                                                        value={editingEvent.title}
                                                                        onChange={(e) => setEditingEvent({...editingEvent, title: e.target.value})}
                                                                        className="w-full px-1 py-0.5 text-xs border rounded"
                                                                        onClick={(e) => e.stopPropagation()}
                                                                    />
                                                                    <div className="flex gap-1">
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); saveEdit(); }}
                                                                            className="bg-green-600 text-white px-2 py-0.5 rounded text-xs hover:bg-green-700"
                                                                        >
                                                                            Save
                                                                        </button>
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); deleteEvent(event.id); setEditingEvent(null); }}
                                                                            className="bg-red-600 text-white px-2 py-0.5 rounded text-xs hover:bg-red-700"
                                                                        >
                                                                            Delete
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <div className="font-semibold">{event.title}</div>
                                                                    <div className="text-xs opacity-75">{event.startTime} - {event.endTime}</div>
                                                                    {event.notes && <div className="text-xs mt-1 italic">{event.notes}</div>}
                                                                    {event.reminders && event.reminders.length > 0 && (
                                                                        <div className="text-xs mt-1 flex items-center gap-1 opacity-75">
                                                                            <Bell style={{width: '10px', height: '10px'}} />
                                                                            {event.reminders.length} reminder{event.reminders.length > 1 ? 's' : ''}
                                                                        </div>
                                                                    )}
                                                                </>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const UserManagement = ({ deleteUser, loadAllUsers, currentUser }) => {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadUsers();
            }, []);

            const loadUsers = async () => {
                setLoading(true);
                const allUsers = await loadAllUsers();
                setUsers(allUsers);
                setLoading(false);
            };

            const handleDelete = async (username) => {
                if (window.confirm(`Are you sure you want to delete user "${username}"? This action cannot be undone and will delete all their data.`)) {
                    await deleteUser(username);
                    await loadUsers();
                }
            };

            if (loading) {
                return (
                    <div className="bg-gray-50 p-4 rounded-lg mb-4 border border-gray-200 text-center">
                        <p className="text-gray-600">Loading users...</p>
                    </div>
                );
            }

            return (
                <div className="bg-gray-50 p-4 rounded-lg mb-4 border border-gray-200">
                    <h3 className="font-semibold mb-4 text-lg flex items-center gap-2">
                        <Users />
                        User Management
                    </h3>
                    <div className="space-y-2 max-h-96 overflow-y-auto">
                        {users.length === 0 ? (
                            <div className="text-gray-500 text-center py-4">No users found</div>
                        ) : (
                            users.map(user => (
                                <div key={user.username} className="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                            {user.username.charAt(0).toUpperCase()}
                                        </div>
                                        <div>
                                            <div className="font-medium flex items-center gap-2">
                                                {user.username}
                                                {user.role === 'admin' && (
                                                    <span className="px-2 py-0.5 bg-purple-100 text-purple-800 text-xs rounded-full">Admin</span>
                                                )}
                                                {user.username === currentUser.username && (
                                                    <span className="px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full">You</span>
                                                )}
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                {user.email && <div>{user.email}</div>}
                                                <div>Joined: {new Date(user.createdAt).toLocaleDateString('en-US', { 
                                                    year: 'numeric', 
                                                    month: 'short', 
                                                    day: 'numeric' 
                                                })}</div>
                                            </div>
                                        </div>
                                    </div>
                                    {user.role !== 'admin' && (
                                        <button
                                            onClick={() => handleDelete(user.username)}
                                            className="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 text-sm transition"
                                        >
                                            Delete
                                        </button>
                                    )}
                                </div>
                            ))
                        )}
                    </div>
                    <div className="mt-4 p-3 bg-indigo-50 rounded-lg text-sm text-indigo-800">
                        <strong>Note:</strong> Admin accounts cannot be deleted. Total users: {users.length}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CorridorWeeklyPlanner />, document.getElementById('root'));
    </script>
</body>
</html>